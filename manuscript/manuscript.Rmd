---
title: The dynamics of risk perception in a Mediterranean agroecosystem
subtitle: 
titlerunning: The dynamics of risk perception in a Mediterranean agroecosystem
authorrunning: Gauthier

authors: 
- name: Nicolas Gauthier 1
  address: Laboratory of Tree-Ring Research & School of Geography and Development, University of Arizona
  email: ngauthier@arizona.edu
  

keywords:
- belief-based agents
- drought risk
- crop diversification
- rapid climate change

abstract: |
  Small-scale agriculturalists in the Mediterranean Basin rely on multiple strategies including diversification, intensification, and storage to maintain a stable food supply in the face of environmental uncertainty. Each of these strategies requires farmers to make specific resource allocation decisions in response to environmental risks and is thus sensitive to variability in both the spatiotemporal pattern of risk and the ability of farmers to perceive that pattern. In this chapter, I present an agent-based model of a Mediterranean agroecosystem. By driving the model with realistic environmental dynamics derived from simulations of mid-Holocene Mediterranean climate, and by allowing the psychology of risk perception to vary among individual farmers, I explore the hidden vulnerabilities of traditional risk-management strategies to periods of rapid climate change. I show that even when farmers are able to manage risk “optimally” in light of past experience, unanticipated changes in the spatiotemporal pattern of rainfall can still lead to major food shortfalls.

bibliography: bibliography.bib
bibstyle: Formato_bibliografia_Springer
# bibstyle options spbasic(default), spphys, spmpsci
output:
  bookdown::pdf_book:
    base_format: rticles::springer_article
    number_sections: yes
header-includes:
- \usepackage{float}
- \floatplacement{figure}{tb}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
library(raster)
library(ncdf4)
library(tidyverse)
library(patchwork)
```


# Introduction {#intro}

Over the past 10,000 years, subsistence farmers in the Mediterranean basin have developed sophisticated strategies to maintain stable food supplies given uncertain rainfall. Their suite of strategies include practices like crop diversification, storage, and exchange [@Halstead1989]). These risk-management strategies all represent forms of \emph{regulatory feedback} used to manage complex socio-ecological systems. Regulatory feedbacks convert a system's high-variance inputs into low-variance outputs by dynamically monitoring the outputs and adjusting internal properties of the system [@Anderies2015]. Risk-managing strategies require farmers to make specific resource allocation decisions in response to environmental risks, and as regulatory feedbacks they are thus sensitive to variability in both the spatiotemporal patterns of risk and the ability of farmers to perceive and act on those patterns.

Crop diversification is an excellent example of a widespread and effective regulatory feedback strategy (Figure 1). Relying on a mix of food types with different climatic tolerances is an efficient way to maintain a robust food supply [@helmers2001separating,Anderies2006]. In the Mediterranean, land-use strategies involving a diversified portfolio of wheat and barley have been employed by even the earliest sedentary farmers, and continue to be used to this day [@GOULD1963a,Slafer1999,Abbo2009a,Marston2011190]. Wheat generally has higher yields but is sensitive to water deficits, while barley has lower yields and is drought tolerant. Planting a mix of wheat and barley, either in the same plot or in a combination of plots, is an effective means of diversifying grain supplies. By adjusting the ratio of wheat to barley, farmers can adapt to changing drought risks.

The secret to the success of earliest farmers on the mediterrenan littoral was in their manipulation of the local ecosystem to manage environmental risks. Early farmers constructed a complex agroecosystem to manage risk.
They needed to maintain stable crop yields in face of uncertain drought risks. Yield stability is very important for traditional agriculturlal communities not connected to larger bulk food networks (Abbo et al 2010)
neolithic crop package -- weiss zohary 2011
cite abbo et al 2010? for more stuff about ladraces
Wheat/barley systems
example of system that combines low yield, low wirks crop with high yield high risk crop, an effective context paut et al 2019
These strategies work when risks are knonw and constant, but may be more susceptible to periods of changing climatic risks
so understanding how people of the past adapted to change is important to us today

Are these crop-diversification strategies vulnerable to the same dynamics as other social-ecological systems with similar regulatory feedbacks mechanisms? One way to address this is to model the influence of imperfect monitoring and biased decision making in uncertain environments. In this study, I accomplish this by answering two main questions:

1. How likely are droughts to occur each year in the eastern Mediterranean, and how did these risks change over the Holocene?
2. How might Neolithic farmers have perceived these changing drought risks, and what were the consequences for farming communities with respect to their collective ability to manage risk?


I couple a climate model with high temporal resolution to a simple game theoretic model of agricultural decision making under uncertainty, in order to examine the performance of optimal and suboptimal wheat-barley diversification practices. I model the year-to-year crop diversification strategies made by farmers as an iterated game of fictitious play against nature [@GOULD1963a]. Farmers are boundedly rational, in that they seek to maximize their objective functions given the perceived probabilities of different actions by nature, but work with flawed mental models of climate-related risks due to imperfect recall of past events. Furthermore, by using a climate model to represent the actions of nature, I can more precisely capture the characteristic autocorrelated patterns of rainfall variability, rather than simply drawing rainfall values from a static distribution. This framework allows me to address the sensitivity of diversification strategies to changes and climatic variability and imperfect human perceptions of those changes.

# Decision-making in a game against nature {#sec:1}

The basic decision-making problem facing a farmer seeking to diversify their crops can be thought of as a game against nature.
We can represent this simplified decision context as a "game" in a game theorietic context (Luce raiffa 1989, milnor 1952, Agrawal1968, cassidy1971, gould 1963). The "game" in this context is the farmer's decision of which crops to plant and in what proportions, given uncertainty in the future "state-of-nature", and nature varies between several possible states such as dry and wet years (Table 1). In reality continuous, but people often intuitively solve an easier problem when faced with a complex real-world situation (cite behavioral econ or simon). The exact values in the payoff matrix here are less important than the relative payoffs in each quadrant. We can think of this game as being the culturally-inherited object. Our question is how do individuals make decisions here? So in this case the cultural norm would be to mix wheat and barley, but the learning is in the exact ratio. 

\begin{table}
\centering
\caption{Estimates of yield volume (t/ha) for ancient wheat and barley varieties derived from [@Slafer1999].}
\begin{tabular}{|l|l|l|}
\hline

 & Dry Year & Normal Year \\ \hline
Barley Yield & 0.93 & 1.18 \\ \hline
Wheat Yield & 0 & 1.60 \\ \hline

\end{tabular}
\end{table}


```{r}
wheat_dry <- 0
wheat_normal <- 1.6

barley_dry <- 0.93
barley_normal <- 1.18
```

How should an early farmer make a decision in light of this uncertainty?
The basic logic of crop diversitication is Portfolio of crops ala modern portfolio theory: Blank2001
Sometimes best to think of nature as a sentient opponent out to get you, and play strategically based on that assumption. Gould 1963,  Beckenkamp 2008
quick overview of criteria without risk, then say that a better option is to estimate the probabilities of the different state of nature
Agrawal1968 talks about the strategies in the context of agriculture being a game against nature
here I can slip in the cool thing about acting like the weather is out to get you being a good idea in states of complete uncertainty
transition -- the problem becomes easier if you have at least some idea of nature's moves, because then you cna work to get the highest yeilds given the risk of drought.
Decision strategies as choosing different points -- plot of decisions

\begin{align}
a^2+b^2=c^2
\end{align}

```{r, fig.height = 3, fig.width = 5, fig.cap = 'Expected wheat and barley yields under increasing drought risk with the point of indifference highlighted.'}
expected_yield_wheat <- function(risk) {
  risk * wheat_dry + (1 - risk) * wheat_normal
}

expected_yield_barley <- function(risk) {
  risk * barley_dry + (1 - risk) * barley_normal
}

expected_yield <- function(risk) {
  expected_yield_wheat(risk) + expected_yield_barley(risk)
}

indiff <- tibble(risk = (barley_normal - wheat_normal) / (wheat_dry - wheat_normal - barley_dry + barley_normal),
                 yield = risk * wheat_dry + (1 - risk) * wheat_normal)
indiff_label <- paste0('(', round(indiff$risk, 2), ', ', round(indiff$yield, 2), ')')

tibble(risk = seq(0, 1, .1),
      Barley = expected_yield_barley(risk),
      Wheat = expected_yield_wheat(risk)) %>%
  gather(type, yield, Barley:Wheat) %>%
  ggplot(aes(risk, yield)) +
  geom_hline(yintercept = indiff$yield, linetype = 2, alpha = .5)+
  geom_vline(xintercept = indiff$risk, linetype = 2, alpha = .5) +
  geom_line(aes(color = type), size = 1.2) +
  geom_point(data = indiff, color = 'black', size = 3) +
  geom_text(data = indiff, label = indiff_label, nudge_x = 0.1, nudge_y = 0.1) +
  theme_classic() +
  #scale_color_manual(name = 'Crop', values = c('darkgoldenrod', 'lightgoldenrod')) +
  scale_color_manual(values = c('#e66101', '#5e3c99'), name = '') +
  labs(x = expression('Drought probability (' * theta * ')'), y = 'Expected yield (t/ha)')
```

If an individual can learn about their environment, such as the risk of drought in any given year, then they can behave more rationally by trying to maximize their subjective expected utility. If the probability distribution of nature's moves is known, the farmer can choose the crop mix that simply maximizes the expected crop yields given the empirical frequency distirubtion of nature's moves. In the language of game theory, this strategy is known as a "game of ficticious play" against nature. This is an effective risk-managing strategy, but like all similar strategies that adapt to a specific pattern of variability, it is vulnerable to changes in the pattern of variability (Janssen eta al 2007)

This strategy works well when the environment is stationary -- nature plays from a fixed probability distirubtion, but is vulnerable to environmental nonstationarity. That is, when the mean or higher order moments of the rainfall distribution shift, playing a game of fictitious play can backfire because as agents get too stuck in their ways while the world changes around them. Thus it is important to understand the dynamics of risk perception -- how subjective risks, and thus subjective expected utility -- rise and fall in uncertain environments.

# Early to mid-Holocene drought risks {#sec:2}

In order to estimate drought risks in the past, we cannot rely on present-day observations alone. Not only does precipitation vary from year-to-year, but it is also subject to centennial and millennial-scale trends and cycles throughout the Holocene that are unresolved in the observational period. Estimating not only the risks of drought in the eastern Mediterranean is therefore not sufficient, and this information must be supplemented with estimates of the *change* in drought risks over time. Climate dynamics are non-linear, non-stationary, and non-ergodic, which means sudden, unpredictable variability is the norm in the region rather than the exception. Using the simulated paleoclimate, rather than modern-day weather station observations or paleoclimate proxies, allows us to estimate not just the first order statistics of the climate system (e.g. the mean and variance of dry years) but also the higher order patterns such as the serial persistence of wet and dry years. This presents a much more realistic picture of the inherent year-to-year uncertainty in the climate system, and presents a realistic challenge to simple risk-managing strategies that assume climatic risks are fixed.

## Paleoclimate simulation

Estimates of changing Holocene drought risks were derived from the TraCE-21ka paleoclimate simulation [@He2011]. TraCE-21ka is a state-of-the-art simulation that uses a coupled atmosphere-ocean general circulation model to recreate the transient response of the global climate system to changes in the Earth's orbit and greenhouse gas concentrations from the Last Glacial Maximum to the present. The simulation generates physically consistent spatiotemporal climate dynamics, driven by current best estimates of external climate drivers (e.g. orbit, greenhouse gasses, glacial meltwater flux). The model simulates these dynamics on a six hourly timescale, and model outputs are archived at a monthly resolution.

Monthly TraCE-21ka precipitation outputs were extracted from the 3.75° grid cell covering Central Anatolia. This location was selected to sample climate patterns typical for key archaeological sites in the region such as Çatalhöyük and Aşıklı Höyük, and for the eastern Mediterranean more broadly. 
```{r}
konya <- matrix(c(32.5, 37.9), nrow = 1) # point at which to sample TraCE
```


```{r}
# convective precipitation
precc <- map(
  list.files('../Data/PRECC', full.names = TRUE)[-12],
  ~ brick(.) %>%
    raster::extract(konya, df = TRUE) %>%
    select(-ID) %>%
    gather(time, precc)
) %>%
  bind_rows()

# large-scale precipitation
precl <- map(
  list.files('../Data/PRECL', full.names = TRUE)[-12],
  ~ brick(.) %>%
    raster::extract(konya, df = TRUE) %>%
    select(-ID) %>%
    gather(time, precl)
) %>%
  bind_rows()
```

## Estimating drought risks

Using the climate model output, I divided each model year into dry years and normal years. A dry year was any year where less than 300mm of rain fell during the wet season (October-May), the threshold below which wheat crops will generally fail [@Wilkinson1997], and a normal year was defined as any year above this threshold. Given the modeled patterns of normal and dry years, the "objective" climatic drought risk $\hat\theta$for any particular year was defined as the proportion of the previous 50 years that were dry year as

\begin{equation}
    \hat\theta = \frac{\sum_{n=t-1}^{t-50} P_n < 300}{50},
\end{equation} 

where $P_n$ is the growing season precipitation accumulation in millimeters for year $n$.

```{r}
sim_past <- left_join(precc, precl, by = 'time') %>%
  mutate(
    rainfall = (precc + precl) * 2.628e+9, # unit conversion
    year = rep(-10200:-5001, each = 12),
    # hardcode dates instead of using ncdf time because of date shift with averaging period
    month = rep(1:12, times = 5200)
  ) %>%
  select(-time,-precl,-precc) %>%
  mutate(water_year = if_else(month %in% 10:12, year + 1L, year)) %>%
  filter(!(month %in% c(6:9))) %>%
  group_by(water_year) %>%
  add_tally() %>%
  filter(n == 8) %>%
  summarise(precip = sum(rainfall)) %>%
  mutate(drought = precip < 300) %>%
  filter(between(water_year, -9500, -5500)) %>%
  mutate(time_step = ceiling(water_year / 50),
         year = time_step * 50) %>%
  group_by(year) %>%
  summarise(risk = sum(drought) / 50) %>%
  filter(year != min(year)) 
```

The simulated risks of crop failure due to drought ranged between 10\% and 46\% during the period from 9.5ka to 5.5ka, with a median risk of 24\% (Figure \@ref(fig:risk)). This means that, on average, a Neolithic farmer in Central Anatolia could expect their wheat crops to fail two or three times a decade, punctuated by even drier periods in which wheat crops could be expected to fail roughly every other year. The simulation also reveals a long-term trend of decreasing drought risks, in particular with higher drought risk in the early Holocene giving way to lower drought risk in the middle Holocene.

```{r risk, fig.height = 2, fig.width = 6, fig.cap = 'Annual risk of wheat crop failure due to drought aggregated by fifty-year period. The dashed line indicates the level of risk beyond which one would plant barley over wheat to maximize subjective expected yields (after Figure 1), given the payoffs defined in Table 1.'}
sim_past %>%
  ggplot(aes(year, risk, fill = risk, color = risk)) +
  geom_hline(yintercept = indiff$risk, color = 'black', linetype = 2, size = 1) +
  geom_col(width = 38)  +
  scale_fill_distiller(palette = 'PuOr') +
  scale_color_distiller(palette = 'PuOr')+
  theme_minimal() +
  labs(x = 'Years BP', y = 'Drought risk') + theme(legend.position = "none")
```

The TraCE-21ka simulation confirms that drought risk in the eastern Mediterranean was non-stationary and, in fact, quite volatile during periods of climatic disruption in the early Holocene. This volatility would have had severe consequences for early farming communities whose risk-managing practices depended so heavily on accurately perceived local climatic risks.


# Modeling risk perception {#sec:3}

In order to properly manage drought risk, a farmer must first be able to perceive that risk. Yet, a farmer's perception of risk reflects more than just the objective, empirical risk observable in the world around them [@Tucker2013]. Individual risk perception is inherently subjective -- influenced by a person's past experience of dry and wet years as filtered through memory -- and can reflect varying levels of uncertainty. Likewise, the distribution of individuals' perceived risks within a population influences the collective perception of drought risks and the potential aggregate societal-level response to those risks.

But how best to model risk perception at the individual level? The human brain does not record every bit of perceived information in memory, rather it stores a "compact encoding" of that information which it uses for future decision-making. The tools of Bayesian statistics provides an elegant solution to the compact encoding problem. Instead of recording detailed memories of each year, a "Bayesian agent" can compactly store their beliefs about the world around them in the form of a prior probability distribution. These agents thus develop beliefs about the risk of drought in their environment through their personal experience of the weather, and their perceptions go on to impact their successive decision-making by altering their subjective expected crop yields from planting different crop mixes.

## Prior beliefs and Bayesian Agents

It is possible to capture the influence of risk perception on decision making computationally by simulating a population of "belief-based" Bayesian agents. A Bayesian agent is one whose subjective beliefs can be represented as a probability distribution over possible states of nature (Kahvalti et al 2019 and others????). 

Here, the probability of a drought occurring in any given year can be treated as a coin flip (i.e. a draw from Bernoulli distribution) with parameter $\theta$ representing the drought probability. The beta distribution is a natural choice for representing knowledge about probabilities because it is constrained to fall between 0 and 1. Hence, an individual agent's prior belief about the value of $\theta$ can be represented as
\begin{equation}
  \theta \sim \textrm{Beta}(\alpha, \,\beta),
\end{equation}
a beta distribution with the parameters $\alpha$ and $\beta$ corresponding to the number of dry and wet years previously experienced by that agent. Varying these two parameters thus allows us to represent a variety of different personal experiences of drought risk. For example, if an agent recalls having lived through 5 dry years and 25 normal years, their prior belief about the chance of a drought occurring in the following year would be represented as a Beta(5, 25) distribution with mean value 0.2 equivalent to the empirical drought risk for that period, $\hat\theta$.

Using probabilities to represent agents' beliefs also allows for estimation of the *uncertainty* in those beliefs (Figure \@ref(fig:prior-prob)). A simple Bayesian agent becomes more certain in their beliefs with age. For example, an agent who experienced 5 wet and 10 normal years and one who experienced 25 wet and 50 normal years would both agree that, on average, droughts occur 50\% of the time. Yet the latter agent would be much more certain in this belief because it is drawn from a larger range of experience (i.e. a larger sample size). We can thus represent the exact information content of each individual agent's subjective experience of droughts using the diffusion of this prior belief. How, then, should an agent update its beliefs in light of new experience? 

```{r prior-prob, fig.width = 5, fig.height = 3, fig.cap = "Development of an individual's perceived drought risk with time, assuming a fixed drought risk of 0.5. Beliefs are represented as Beta probabiity distributions, and the increased certainty with age reflects the varying effective sample size of the Beta prior."}
prior <- function(m, n) {
  domain <- seq(0,1,0.005)
  val <- dbeta(domain, n * m, n * (1 - m))
  tibble('x' = domain, 'y' = val)
}

tibble(Age = seq(5, 50, 5),
       risk = 0.5) %>%
  mutate(belief = map2(risk, Age, ~prior(.x, .y))) %>%
  unnest(cols = c(belief)) %>%
  ggplot(aes(x, y)) +
  geom_line(aes(group = Age, color = Age), size = 1.2, alpha = .8) +
  scale_color_distiller(palette = 'PuOr', guide = 'legend') +
  labs(x = expression('Drought probability (' * theta * ')'), y = 'Density') +
  theme_classic()
```


## Individual learning and Bayesian updating

As a Bayesian agent moves through time and observes each successive year's weather, it must be able to update its beliefs accordingly. It does does by comparing the information in this year's observation with the cumulative weight of their past experience. The agent combines its prior beliefs about drought risk with the likelihood of observing a drought this year in order to generate a posterior distribution representing its updated beliefs about the world. 

Crucially, the strength of one's prior beliefs determines how much weight is given to new information. For example, assume two agents -- one aged 15 and the other aged 50 -- who have only ever experienced a moist climate where droughts happen on average two out of every ten years. The mean value of $\theta$ for both agents would thus be 20\%, but the degree of certainty varies because the older agent is basing this inference on many more years of experience. Now assume the climate suddenly changes such that the drought risk is doubled to 40\% for the next 25 years (Figure \@ref(fig:posterior)). Because the prior beliefs of the agents were so different, their subjective beliefs after the drought are also different *even though each agent experienced the exact same objective drought risk*.

For young agents with weak priors, the information of each new year can thus strongly influence their beliefs. For older agents who have experienced many more years their priors will be stronger, and they will be less likely to update their beliefs when balancing the information from a single year with the many decades of accumulated experience. As was the case with the simple game of fictitious play discussed in Section \@ref(sec:1), having conservative beliefs is fine when the environment is stable and risks do not vary. But when there is volatility in the environment, and risks can indeed change, the ability to change one's mind is crucial. Being too inflexible in one's priors can lead being too optimistic when things really have changed for the worse, or alternately being too conservative when conditions ultimately improve.

```{r posterior, fig.width = 6, fig.height = 3, fig.cap = "Change in perceived drought risks in an older (50) and younger (15) agent before and after a 25-year dry period."}
prior2 <- function(a, b) {
  domain <- seq(0,1,0.005)
  val <- dbeta(domain, a, b)
  tibble('x' = domain, 'y' = val)
}

tibble(alpha = c(15 * 0.2, 50 * 0.2, 15 * 0.2 + 25 * 0.4, 50 * 0.2 + 25 * 0.4),
       beta = c(15 * 0.8, 50 * 0.8, 15 * 0.8 + 25 * 0.6, 50 * 0.8 + 25 * 0.6),
       time = factor(c('prior', 'prior', 'posterior', 'posterior'), levels = c('prior', 'posterior')),
       age = factor(c('15-year-old agent', '50-year-old agent', '15-year-old agent', '50-year-old agent'), levels = c('15-year-old agent', '50-year-old agent'))) %>%
  mutate(belief = map2(alpha, beta, ~prior2(.x, .y))) %>%
  unnest(cols = c(belief)) %>%
  ggplot(aes(x, y)) +
  geom_line(aes(group = time, color = time), size = 1.2, alpha = .8) +
scale_color_manual(values = c('#5e3c99', '#e66101'), name = '') +
    facet_wrap(~age, strip.position = 'bottom') +
    theme_classic() +
  theme(strip.background = element_blank(),
        legend.position = c(.43, .5),
        strip.placement = "outside") +
  labs(x = expression('Drought probability (' * theta * ')'), y = 'Density')
```


# Risk management and the dynamics of risk perception {#sec:4}




online learning, so only ever +1 or 0 in each case


This updated posterior distribution becomes the agent's prior for the following year, and the process repeats itself. Formally, this iterative process is known as "online" learning from Bernoulli observations, where "online" refers to the sequential, year-to-year updating [@Bissiri2010]. 

Its important to note that, although these perceptions can be biased away from the true climatic drought risk, they still reflect perfectly rational beliefs.

What's important to remember here is that both agents are acting rationally based on their prior subjective beliefs, they only differ in those beliefs. So the conservatism of the older agent and the flexibility of the younger agent are not wrong per se, they simply reflect different rational approaches to the world.

So what are the consequences of these cognitive processes for early farmers in the Mediterranean?

Simulate a time series with varying drought frequency, based off the empirical drought risks derived from the paleoclimate simulation.

This suggests that people are more in danger of not realizing conditions are improving when they actually have -- the opportunity cost -- rather than failing to realize the change in the first place.
The law of small numbers is very important here. The range of each person's experience is so small -- every individual's perceived risk will be a small and noisy sample of the true value.
Older people are much more certain, even though they are wrong.


That is, what if the risk of a drought, theta, is not a constant but rather varies unpredictably in time?
The statistical problem shifts then to one of change detection (o'reilly 2013, gallistel et al 2014).
In other words do people simply adapt to changes -- as in the fixed bayesian learner and moving average approaches -- or do they detect them?
Strict year-to-year updating can result in overly conservative risk perceptions, suggesting people are slow to change their beliefs when in reality they often quickly update them (Bissiri 2010).
Indeed, the "forgetful bayesian brain" model seems to perform better, with a dynamic rather than fixed bayesian belief model (Zhang and Yu 2013).

That is, the above figure assumes a noise free environment with a single learner. Next we can look at a population of learners in a noisy environment


Examining the long-term dynamics of crop yields among all decision-making strategies and psychological profiles reveals variability in yields due to different decision making preferences is far greater than variability due to differences in risk perception (Figure 7). Risk-minimizing strategies sacrifice productivity for predictability, consistently lowering the mean and variance of crop yields over time. Risk-minimizing strategies are more sensitive to risk perception than yield-maximizing strategies; varying the memory decay rate parameter $\lambda$ had no effect on the optimal crop allocation for yield maximizers. 
^^ change above to talk about individual uncertainty in drought risk is often greater than the actual variability in drought risk, given the limited life experience an individual draws from

During periods of climatic stability, allowing past experiences to influence decision making helps farmers minimize the impacts of \emph{predictable} drought. But past experiences are less informative during periods of rapid climate change, and even farmers who manage risk “optimally” experience major food shortfalls. Climatically-induced variability in food supplies consistently surpasses that from differences in risk-perception psychology, but not that from different risk aversion preferences. This finding suggests that the efficacy of risk managing strategies that rely on regulatory feedbacks is limited to periods of relative climatic stability. This is consistent with the observation from the Roman Period Mediterranean that while minor food crises were common in the ancient world, extreme famines were rare [@Garnsey1989].


```{r}
agents <- tibble(id = 1:150, 
                 alpha = 1.5,
                 beta = 1.5,
                 risk = alpha / (alpha + beta),
                 #age = sample.int(80, size = 150, replace = TRUE),
                 crop = 'barley')

learn <- function(agents, drought) {
  if (drought == 'TRUE') wheat_yield <- wheat_dry; barley_yield <- barley_dry
  if (drought == 'FALSE') wheat_yield <- wheat_normal; barley_yield <- barley_normal

  agents %>%
    # farmer's turn to decide what to plant
      mutate(yield_exp = expected_yield(risk),
         barley_exp = expected_yield_barley(risk),
         wheat_exp = expected_yield_wheat(risk),
         expected_yield = barley_exp + wheat_exp,
         crop = case_when(barley_exp > wheat_exp ~ 'barley',
                              barley_exp < wheat_exp ~ 'wheat',
                              barley_exp == wheat_exp ~ 'either'),
         prediction = map2(alpha, beta, ~rbeta(100, .x, .y)), # sample 100 as if agent is thinking in percentages
         wheat_prop = map_dbl(prediction, ~sum(. < indiff$risk)) / 100) %>%
      select(-prediction) %>%
  # nature's turn to decide realized yields
    mutate(payoff = wheat_yield * wheat_prop + barley_yield * (1 - wheat_prop),
           alpha = drought + alpha,
           beta = beta + 1 - drought,
          # mu = alpha / (alpha + beta),
           risk = map2_dbl(alpha, beta, ~rbeta(1, .x, .y)))
}

make_droughts <- function() c(runif(25) < 0.2, runif(25) < 0.4, runif(25) < 0.2)

set.seed(11111)
droughts <- make_droughts()

run_sim <- function(droughts) {
  accumulate(droughts, ~learn(.x, .y), .init = agents) %>% 
    bind_rows(.id = 'time') %>%
    mutate(time = as.numeric(time)) %>%
    filter(time > 1)
}

sim1 <- run_sim(droughts)
```


```{r dynamics, fig.height = 8, fig.width = 7, fig.cap='The dynamics of risk perception.'}
a <- ggplot(sim1) +
  geom_rect(aes(xmin = 25, xmax = 50, ymin = -Inf, ymax = Inf), fill = 'lightgray', alpha = .1) +
  geom_point(aes(time, risk), alpha = .1) +
  geom_hline(yintercept = indiff$risk, color = 'red', linetype = 2) +
  theme_classic() +
  labs(x = 'years', y = 'Perceived drought risk')

b <- sim1 %>%
  group_by(time, crop) %>%
  tally() %>%
ggplot(aes(time, n, fill = crop, color = crop)) +
  geom_bar(width = 1, stat = 'identity', position = 'fill') +
  #scale_fill_manual(values = c('darkgoldenrod', 'lightgoldenrod')) +
  #  scale_fill_manual(values = c('#e66101', '#5e3c99'), name = '') +
    scale_fill_manual(values = c('#f1a340', '#998ec3'), name = '') + 
    scale_color_manual(values = c('#f1a340', '#998ec3'), name = '') + 
    labs(x = 'Years', y = 'Wheat proportion') +
  theme_classic()

a / b
```


These two plots begin to look more alike the more you sample, which makes sense because its an ergodic system.

Note in these plots above and below we're summing all the wheat and barley in the population, compared to below which shows the wheat proportions of individuals.


# Conclusion

Given the average drought risks estimated from TraCE-21k and assuming perfect monitoring and recall of recent droughts (i.e. $\lambda = 0$), farmers intent on minimizing the risk of crop failure would be expected to plant about 65\% barley to 35\% wheat on average. This proportion is within the range estimated from macrobotanical remains at a nearby archaeological site [@Marston2011190]. Yield maximizing farmers instead play a pure strategy profile, planting wheat if the perceived drought risk is less than 0.68 and barley if it is more. Because the GCM-simulated drought risk never rises above this threshold, a yield-maximizing farmer will always plant a wheat monocrop.



Not only does this approach have a clear computational efficiency, but for the same reason this reflects the processes actually going on in the heads of decision makers.

Even if individuals aren't -- consciously or unconsciously -- making these calculations, the basic algorithmic problem faced by the brain, and the solutions it has evolved, reflect the same basic constraints (Sanborn and Chater 2016).

Statistically downscaling palaeoclimate simulations and coupling them to game theoretic models of decision making under uncertainty is a simple way to better understand the patterning of climate changes and the regulatory feedbacks farmers use to adapt to them. To further explore these patterns, future work should incorporate additional risk-minimizing strategies such as storage and exchange. Food storage and exchange can also be thought of as forms of diversification, the former in the time and the latter in space [@Marston2011190]. Food exchange would be of particular interest from a game theoretic perspective, as incomplete information with respect to an exchange partner's crop diversification and storage practices can lead to situations of moral hazard.


Think about the importance of the population's age structure, becuase that's going to impact the collective memory of drought.

\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
\setlength{\parskip}{8pt}


# References
